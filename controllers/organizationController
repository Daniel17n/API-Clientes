const Organization = require('../models/organizationModel');
const Tasks = require('../models/tasksModel');
const User = require('../models/userModel');

function createOrganization(req, res) {
  const organization = new Organization(req.body);
  organization.save((err, newOrganization) => {
    if (err) return res.status(400).send({ message: 'Error saving this organization', error: err });
    return res.status(200).send(newOrganization);
  });
}

function shareTasks(req, res) {
  const { organization } = req.body;

  User.find(organization, (err, user) => {
    if (err) return res.status(404).send({ message: 'This organization does not exists' });
    const { userEmail } = user;
    Tasks.find(userEmail, (error, tasks) => {
      if (error) return res.status(404).send({ message: 'No user from this organization has a task' });
      return tasks;
    });
  });
}

module.exports = {
  createOrganization,
  shareTasks,
};
